// src/api/Producto.api.js
import { api } from './roles';

// Usuarios (si aplica en este m√≥dulo)
export const getUsuarios = () => api.get('usuarios/');
export const updateUsuario = (id, payload) => api.put(`usuarios/${id}/`, payload);

/* ----------------------------- PRODUCTOS ----------------------------- */

// Obtener todos los productos
export const getALLProductos = async () => {
  try {
    const response = await api.get('producto/');
    return response;
  } catch (error) {
    handleProductoError(error);
  }
};

// Crear un nuevo producto
export const createProducto = async (producto) => {
  try {
    const formData = new FormData();

    // Iteramos y agregamos todas las propiedades del producto
    for (const key in producto) {
      if (producto[key] !== undefined && producto[key] !== null) {
        formData.append(key, producto[key]);
      }
    }

    return await api.post('producto/', formData, {
      headers: {
        'Content-Type': 'multipart/form-data' // üëà necesario para que Django lo entienda
      }
    });
  } catch (error) {
    handleProductoError(error);
  }
};

// Eliminar un producto por ID
export const deleteProducto = async (id) => {
  try {
    return await api.delete(`producto/${id}/`);
  } catch (error) {
    console.error('Error en deleteProducto:', error);
    handleProductoError(error);
  }
};

// Actualizar un producto por ID
export const updateProducto = async (id, producto) => {
  try {
    return await api.put(`producto/${id}/`, producto);
  } catch (error) {
    handleProductoError(error);
  }
};

/* ----------------------------- CATEGOR√çAS ----------------------------- */

// Obtener todas las categor√≠as
export const getCategorias = async () => {
  try {
    return await api.get('categoria/');
  } catch (error) {
    console.error('Error al obtener categor√≠as:', error);
    throw error;
  }
};

/* ----------------------------- SUBCATEGOR√çAS ----------------------------- */

// Obtener las subcategor√≠as filtradas por ID de categor√≠a
export const getSubcategoriasPorCategoria = async (idCategoria) => {
  try {
    return await api.get(`subcategoria/?categoria=${idCategoria}`);
  } catch (error) {
    console.error('Error al obtener subcategor√≠as:', error);
    throw error;
  }
};

/* ----------------------------- MANEJO DE ERRORES ----------------------------- */

function handleProductoError(error) {
  if (error.response) {
    switch (error.response.status) {
      case 404:
        throw new Error('El producto no fue encontrado');
      case 500:
        throw new Error('Error interno del servidor. Por favor, intente m√°s tarde');
      default:
        throw new Error(
          error.response.data?.detail ||
          error.response.data?.message ||
          'Error al procesar la solicitud'
        );
    }
  } else if (error.request) {
    throw new Error('No se pudo conectar con el servidor');
  } else {
    throw new Error('Error al procesar la solicitud');
  }
}
